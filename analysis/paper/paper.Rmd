---
title: "Bayesian exponential random graph modeling of KWL Burial network"
author:
  - Author One
  - Author Two
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---


<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/"
)
```

# Introduction

<!--burial study- network analysis-->
Burials provide valuable information about social structures that reflect not only the personal life and status of the deceased, but also the expressions of their descendants, from which we are able to detect the social differences that can relate to social inequality and complexity [@Ehrhardt2009; @Gamble2002; @Janes2013; @Johansen2015]. Mortuary practices such as burial forms, grave goods, and related ritual practices could represent the social relations between individuals and allow us to infer social structures, for examples, grave goods usually relate to social practices of trade, exchange, and gifting [@Coward2013, pp. 252]. One way to study the relationships between individual is social network analysis (SNA), which can visualize, quantify, and statistically test hypotheses about the relationships to understand network structure and its effects on every part within the network [@Freeman2004; @Salvini2010]. A social network contains a set of actors and a set of relationships connecting these actors, which could be groups, organizations or persons. Their relationships are flows of resources that reflect relations of control, dependence, and cooperation. In other words, actors are viewed as "nodes" in a wider network, in which nodes are connected by multiple relationships, or "edges", to other nodes [@Coward2013; @Mizoguchi2013; @Potgieter2008]. 

<!--current approaches to network analysis-->
Exponential Random Graph Models (ERGMs) are an important family of statistical model for expressing properties of network structures with a focus directly on possible ties between nodes by viewing them as random variables [@Robins2007]. In traditional statistical model for network, each predictor variable for forming a tie between two nodes is measure separately by the presence of a tie without considering interactions among ties [@Morris2008]. By contrast, statistical models assumes social networks as dependent variables that can represent the network dependencies between tie variables [@Snijders2011]. In a network generated by ERGMs, the formation of a tie is influenced by the presence or absence of other ties or attributes of nodes/ties. Predictor variables, called network statistics, such as reciprocity, transitivity, homophily, are direct functions of the ties themselves where the probability of occurrence of the configuration of ties can be specified and hypothesized [@Morris2008; @Robins2007]. With the development of Markov chain Monte Carlo (MCMC) algorithms that produce approximate maximum likelihood estimators and graph statistics for further specification of transitivity and heterogeneity, ERGMs can deal with complicated dependence patterns observed at one moment in time [@Snijders2006]. The advantage of networks specification under assumptions and contexts can be useful to explain archaeological network in a given time. @Amati2019 demonstrate the use of ERGMs to reconstruct networks consist of a set of sites in the Caribbean during the period AD 100‚Äì400. They found out the structure of network can be efficiently explained by multiple interdependent mechanisms instead of hypotheses of distance and cultural homophily exclusively. However, they also point out some limitation of ERGMs

However, two major limitations ERGMs are difficult to compute because their normalizing constant depending on model parameters is intractable. A Bayesian framework allows for parameter inference using Markov chain Monte Carlo (MCMC) strategies which avoid the need for computationally intensive calculations of the normalizing constants [@Caimo2011]. 

## Bayesian modeling 
<!--Bayesian inference for Exponential Random Graph Models--> 
Bayesian approach to ERGMs is an efficient computational tool for social network analysis because it incorporates prior information about the network effects into the model and offers uncertainty quantification by evaluating the posterior distribution of the parameters associated with the network effects [@Caimo2015; @Nemmers2019]. This provides better estimations for complex social network models with heterogeneous data [@Caimo2017]. For archaeological data, missing data could be a problem leading to misinterpretation, which can be also reduced by using Bayesian modelling that provides average 80% correct prediction for the ties and allow 25% false with a third of data missing [@Koskinen2010].
- weighted data

Using the R language, we use Bayesian SNA to study burials from Kiwulan, an Iron Age site in northeast Taiwan. We view individual burials as actors or nodes in the social network with ties drawn between burials when the presence of the same variables that can represent the same "community" or social group. We test hypotheses about the distribution of influence in the network to identify network or corporate mode conditions. We ask the questions: 1. Do the observed burial data indicate a more clustered network than a distribution of random networks with similar qualities? 2. Whether European colonial activities in 17 century Taiwan resulted in the emergence of social inequality in an indigenous society can be detected by burials networks. 3. How the relations among burials may affect the quantity of burial goods? We expect the network to present a higher degree of clustering (e.g. the number of completed triangles in the network) in the European contact period that might hint at social heterogeneity during this period. This study helps to expand the use of burials in understanding the indirect effects of a colonial presence on indigenous groups. A Bayesian approach enables the efficient quantification for uncertainty, parametrization, and model evaluation of social network metrics.

# Archaeological background

```{r read-data}
library(readxl)
library(tidyverse)
library(here)

# read data
burial <- read_excel(here("analysis", "data", "raw_data", "Kiwulan_Burials.xlsx"))
```

```{r tidy-data}
# combine some periods
burial_three_period_tidy <-
  burial %>%
  rename(burial_label = ID) %>%
  mutate(Phase = ifelse(Phase == 'euro', 'post', Phase)) %>%
  filter(!is.na(Phase)) %>%
  mutate(Gold_leaf = ifelse(Gold_leaf == "shatter", "1", Gold_leaf),
         Stoneware = ifelse(Stoneware == "base", "1", Stoneware),
         Stamped_ceramic = ifelse(Stamped_ceramic == "cluster", "1", Stamped_ceramic)) %>%
  mutate_at(21:ncol(.), as.numeric) %>%
  janitor::remove_empty(which = "cols") %>%
  mutate(total = rowSums(.[c(21:48, 50, 55, 56)], na.rm = TRUE)) %>% #prestige goods
  mutate(Porcelain = rowSums(.[c(40:48, 55, 56)], na.rm = TRUE)) %>% #B&W, porcelain, Anping, kendi
  mutate(Porcelain = ifelse(Porcelain == 0, NA, Porcelain)) %>%
  mutate(quantity = case_when(
    total == 0 ~ "none",
    total > 0 & total <= 7 ~ "low",
    total > 7 & total < 100 ~ "medium",
    total >= 100 ~ "high",
    TRUE ~ "other")) %>% # the classification is based on the result of histogram
  mutate(Age_scale = case_when(
    `Age` %in% c("1","2") ~ "0-12",
    `Age` == "3" ~ "12~20",
    `Age` %in% c("4","5","6","7","8") ~ "+20",
    TRUE ~ "NA")) %>%
  mutate(Gold_bead_low = ifelse(Golden_bead == 1, 1, NA),
         Gold_bead_med = ifelse(Golden_bead > 1 & Golden_bead <10, 1, NA),
         Gold_bead_high = ifelse(Golden_bead > 10, 1, NA),
         Agate_bead_low = ifelse(Agate_bead == 1, 1, NA),
         Agate_bead_med = ifelse(Agate_bead > 1 & Agate_bead <10, 1, NA),
         Agate_bead_high = ifelse(Agate_bead > 10, 1, NA),
         `Indo-Pacific_bead_low` = ifelse(`Indo-Pacific_bead` < 100, 1, NA),
         `Indo-Pacific_bead_med` = ifelse(`Indo-Pacific_bead` > 100 & `Indo-Pacific_bead` < 900, 1, NA),
         `Indo-Pacific_bead_high` = ifelse(`Indo-Pacific_bead` > 900, 1, NA)) %>% 
  # the low-med-high index is determined by interpretation for histograms for those burial good types
  select(burial_label,
         Phase,
         Age_scale,
         Gold_bead_low,
         Gold_bead_med,
         Gold_bead_high,
         Agate_bead_low,
         Agate_bead_med,
         Agate_bead_high,
         #Agate_bead, #female burials
         #Golden_bead,
         Porcelain,
         Gold_leaf, #prestige good
         fish_shape_knit, #prestige good
         #Bell, #children's burials
         quantity)
         #total) # select specific variable to drop columns (uninformative variables)

# number of each phase
burial_three_period_number <-
  burial_three_period_tidy %>%
  count(Phase)
```

```{r network-object-pre}
# filter pre burials
burial_pre <-
  burial_three_period_tidy %>%
  filter(Phase == "pre") %>%
  janitor::remove_empty(which = "cols")

# create node list using burial index by phase
#--------------------pre--------------------------------
nodes_pre <-
  burial_three_period_tidy %>%
  filter(Phase == "pre") %>%
  select(burial_label) %>%
  rowid_to_column("id")

# pair wise combinations for burials as index for later map function
library(gtools)
burial_comb_pre = combinations(length(nodes_pre$burial_label), #t(combn(nodes_pre$burial_label, 2))
                               2, nodes_pre$burial_label,
                               repeats = TRUE)
colnames(burial_comb_pre) = c("burial_1", "burial_2")
burial_comb_pre = as_tibble(burial_comb_pre)

# create list for each burial that contains the burial good types and their counts
edge_list_pre <-
  burial_three_period_tidy %>%
  select(burial_label, 4:12) %>% # need to change for each exploration
  pivot_longer(-burial_label, names_to = "goods", values_to = "count") %>%
  #mutate(burial_connection = rep(unique(burial_label), length.out = length(burial_label)))
  group_by(burial_label) %>%
  nest()

# pair-wise list
common_counts_lst_pre <-
map2(burial_comb_pre$burial_1,
     burial_comb_pre$burial_2,
     ~bind_cols(
       edge_list_pre %>%
       filter(burial_label == .x) %>%
       unnest(data),
       edge_list_pre %>%
         filter(burial_label == .y) %>%
         unnest(data)) %>%
       rowwise() %>%
       mutate(common_counts = sum(count, count1)))

# count of ornament types in common between each pair of burials
common_counts_vct_pre <- map_int(common_counts_lst_pre, ~sum(!is.na(.x$common_counts)))

burial_comb_with_common_counts_pre <-
burial_comb_pre %>%
  mutate(common_counts = common_counts_vct_pre) %>%
  mutate(common_counts = ifelse(burial_1 == burial_2, 0, common_counts)) # use 0 for self loop

# change label to ids for node linking
edges_pre <-
  burial_comb_with_common_counts_pre %>%
  left_join(nodes_pre, by = c("burial_1" = "burial_label")) %>%
  rename(from = id) %>%
  left_join(nodes_pre, by = c("burial_2" = "burial_label")) %>%
  rename(to = id)

edges_for_network_pre <-
  select(edges_pre, from, to, common_counts) %>%
  filter (!common_counts == 0) # remove rows with no goods in common
 # %>% mutate(common_counts = ifelse(common_counts > 1, 1, common_counts)) # for unweighted network
```

<!--archaeological setting-->
The burial data we analyzed in this paper are collected from the upper component of Kiwulan site, an Iron Age settlement site (AD1350-AD1950) located in northeastern Taiwan which experienced the European colonial impacts in the 17th century and the large wave of Chinese immigrants in the 19th century. The excavation revealed abundant pottery sherds, imported ceramics and stonewares, wooden artifacts, stone tools, metal artifacts, imported glass beads and agates beads, and pipes [@Chen2007]. In addition to these artifacts, 90 burials, hundreds of middens, storage pits, and postholes with in-situ posts were also excavated. The burials were mostly located in the AD section, which is the largest open area at Kiwulan site that provides continuous stratigraphic sections suitable for comparison. Those burials are oriented in an east-west direction located on the north side of the house structures indicated by postholes and in-situ wooden posts. Previous research indicates the presence of economic inequality between burials, but there is debate about whether these represent an egalitarian or stratified society [@Cheng2008; @Hsieh2012]. @Cheng2008 interprets the unequal distribution of prestige materials, such as the golden beads, between burials, as evidence for hierarchy. However, @Hsieh2012 suggests a relatively egalitarian form from the comparative analysis of frequency and proportion of burial goods. She finds that the rich burials were usually associated with elders, which might indicate achieved, rather than inherited, status. The use of prestige goods in burials might be traced back before the European arrival according to historical records from Spanish and Chinese [@Borao2009; @LiandWu2006). Analysing burial data will give an insight into the social reactions of Kiwulan residents and provide a way to examine and explain the changes in social inequality at Kiwulan before and after European contact.

<!--chronology-->
Burials were assigned to the pre-European period, European and post-European period, and Chinese period for network comparison. Since the sedimentary characteristics show vertical and lateral continuity cross units of AD section, depth is used as the first criterion for burial chronology. The chronology is then evaluated by the burials with light grey glazed jars, also called An-ping jars produced most likely in China and circulated in Southeast Asia from the late 16th to 18th century but are often found at sites with the European occupation in the early 17th century in Taiwan [@Berrocal2018; @Hsieh1995; @Ketel2011]. In addition to the diagnostic porcelain, three radiocarbon dates of charcoal associated with three different burials are used as another evidence to evaluate the chronology [@Chen2007]. Some burials that were heavily disturbed by modern construction are excluded to avoid misinterpreting from incomplete data. 

<!--unanswered issues-->
The archaeological sites in northeastern Taiwan show some evidence of accumulation of imported prestige goods in burials [@Cheng2008], which might indicate the pursuit of prestige or wealth. In addition to prestige, European colonial powers could have provided military support to indigenous allies. For example, Voss‚Äôs (2005) study of a colonial outpost in California shows that colonial residents have different identities and higher social status than other local indigenous people. A general model to summarize these case studies might be that the support of a colonial power combined with high local values for imported goods, might lead to competition among individuals. In this study, I will use this model of competition to explain the changes in social inequality at Kiwulan before and after European contact.

Based on the quantity of grave goods among burials, we can reconstruct social networks from the distribution of prestige goods, including imported ceramic and beads based on the principle that prestige materials usually relate to social status. We build network where burials represent actors (nodes in the network) linked by sharing the same prestige goods. 

We assume burial network represents the relations among people and social structure based on the argument that 

# Methods

<!--procesures--> 

## data

We use burial data collected based on published excavation report, and original excavation records with detailed stratigraphy and context description. Burial data provides information about direction, size, depth, age, gender, classes and quantity of grave goods, and spatial relationship between them. We consider the effects of both exogenous and endogenous factors to generate meaningful explanation of the characteristics of burial network and tendency of burials correlate with each other. To be specific, our purpose is to understand the underlying mechanisms of the network structures and how the relationship influence on the pattern of accumulation of wealth during different foreign contact periods. We focus on connectivity, clusters, centralization, and homophily among those burials that could reflect the social relations between individuals guided by social structures. Previous studies have shown that there are some evidence of social inequality observed from Kiwulan but the degree over time and causes remain unclear. To answer our question for the shifts in social inequality to a more wealth differentiation during and after the arrival of the foreign presences, we hypothesize: 

‚Ä¢ Hypothesis 1: There are significant reciprocal structure effects in burial network before the contact
‚Ä¢ Hypothesis 2: There are significant transitivity structure effects in burial network after the contact
‚Ä¢ Hypothesis 3: There are significant popularity structure effects in in burial network after the contact

The computational processes in this paper were performed by the ergm package for simulation and model specification and then bergm package using R programming [@Hunter2008; @Morris2008; @Caimo2014]. We set the number of chains to eight. For each chain, the number of burn-in iterations is 200 and the number of iterations after the burn-in is 2000. We set the number of iterations used to simulate a network y‚Ä≤ at each iteration to 10000. The models are assessed by goodness-of-fit (GOF) diagnostics in the Bayesian framework, where the observed network is compared with a set of networks simulated from the estimated posterior distribution of the parameters of the model [@Caimo2011; @Caimo2017]. This provides a statistical way to check how well the estimated posterior parameter distribution can reproduce networks similar to the general structural features of the observed network. 

Since the accumulation of imported prestige goods in burials is commonly observed, we assign the burials into four classes, high, medium, low, and none, according to the total number of burial goods as an index of wealth.

## Model specification and estimation
<!--Network construction-->

some concepts:
- endogenous statistics that ties are modelled based on the existence of other ties
- exogenous statistics that ties are formed according to monadic or dyadic node attributes

We used ergm package in R for the model specification. Every term in an ERGM must have an associated algorithm for computing its value for network [@Morris2008]. The terms we selected for network specification include:

1. edges: ties, a measure of density, equal to kstar(1) for undirected networks

2. gwesp (geometrically weighted edgewise shared partners): triad-based clustering based on a dyad-based configurations (not node-based) that counts the number of times that both nodes have a tie to a third node. It is a measure of the tendency for two actors who are tied to have x partners in common. In other words, a tendency for those with shared partners to become tied, or tendency of ties to cluster together.

3. gwdegree (geometrically weighted degree distribution): a parametric form that represents the frequency distribution for nodal degree, each node counts only once. The local configuration is degrees and stars that are equivalent representations for the distribution of node-based edge counts. A measure of the tendency of the number of edges into a node. This statistic captures the tendency towards centralisation in the degree distribution of the network.

4. nodematch: uniform homophily between nodes that refers to the similarity of connected nodes. A statistics that counts the number of edges between nodes sharing the same covariate value or characteristics. We use wealth index and age as covariants that reflects the similarity between nodes. 

<!--Model fitting and comparison to alternative approaches-->

<!-- Goodness-of-fit assessment-->

# Results

```{r network-ggraph}
# network analysis using ggraph pkg
library(tidygraph)
library(ggraph)

relation_tidy_pre <- tbl_graph(nodes = nodes_pre,
                               edges = edges_for_network_pre,
                               directed = FALSE)

relation_tidy_pre %>%
  activate(edges) %>%
  arrange(desc(common_counts))

# plot
ggraph(relation_tidy_pre, layout = "graphopt") +
  geom_node_point() +
  geom_edge_link(aes(width = common_counts), alpha = 0.8) +
  scale_edge_width(range = c(0.2, 2)) +
  geom_node_text(aes(label = burial_label), repel = TRUE) +
  labs(edge_width = "common item") +
  theme_graph()
```

```{r network-ggraph}
# network analysis using ggraph pkg
library(tidygraph)
library(ggraph)

relation_tidy_pre <- tbl_graph(nodes = nodes_pre,
                               edges = edges_for_network_pre,
                               directed = FALSE)

relation_tidy_pre %>%
  activate(edges) %>%
  arrange(desc(common_counts))

# plot
ggraph(relation_tidy_pre, layout = "graphopt") +
  geom_node_point() +
  geom_edge_link(aes(width = common_counts), alpha = 0.8) +
  scale_edge_width(range = c(0.2, 2)) +
  geom_node_text(aes(label = burial_label), repel = TRUE) +
  labs(edge_width = "common item") +
  theme_graph()
```


```{r network-network-pkg}
# network analysis using network pkg
library(network)

burial_network_pre <-
  network(edges_for_network_pre, # the network object
          vertex.attr = nodes_pre, # node list
          directed = FALSE, # specify whether the network is directed
          ignore.eval = FALSE, # FALSE = weighted
          loops = FALSE, # do we allow self ties (should not allow them)
          matrix.type = "edgelist") # the type of input

# plot
plot(burial_network_pre, vertex.cex = 1) # last two nodes are missing?? only 27 nodes
```

```{r add-node-attribute-color}
# prepare notwork objects for Bayesian ERGMs 
library(statnet)
library(Bergm)

# Add attributes to the network object burial_network_pre
set.vertex.attribute(burial_network_pre, "quantity", burial_pre$quantity)
set.vertex.attribute(burial_network_pre, "age", burial_pre$Age_scale)

# plot
set.seed(30)
quantity <- get.vertex.attribute(burial_network_pre, "quantity")
age <- get.vertex.attribute(burial_network_pre, "age")

ID <- get.vertex.attribute(burial_network_pre, "burial_label") # not sure how to get id on the network plot

plot(burial_network_pre,
     vertex.col = "quantity", # age
     vertex.cex = 1.5)

legend("topleft",
       col = c(2, 3, 1, 4), # need to adjust each time
       pch    = 20,
       legend = unique(quantity), # age
       title  = 'Burial good counts')

#? can't get the items in legend in order, tried as.factor and set their level but does not work
#? can't match color with categories, using an odd method at the moment
```

## ERGM parameter estimation
<!--interpretation of network plots across phases--> 

```{r network-ERGMs}
# model 1
model.ergm <- burial_network_pre ~
  edges + # ties, a measure of density, equal to kstar(1) for undirected networks
  density +
  triangle # triad relation, a measure of clustering or cohesion, also called transitive triple in undirected network, can be replaced by "gwdegree"
summary(model.ergm)

# model 2, check here Morris et al. (2008) 
# check out the terms: http://mailman13.u.washington.edu/pipermail/statnet_help/2010/000575.html
model.2 <- burial_network_pre ~ edges + # density
  gwesp(0.2, fixed = TRUE) +  # transitivity(cohesion; triangle)
  # number means weight parameter alpha, which controls the rate of declining marginal returns
  # fixed = TRUE means the scale parameter lambda is fit as a curved exponential-family model
  # not much difference in a range of 0-1.5, the lower the value of the scaling parameter, the less likely the model is to be degenerate
  # ergm can estimate the parameter from the data by using fixed=FALSE

  gwdegree(0.8, fixed = TRUE)  # popularity(degree; star), the frequency distribution for nodal degrees
  # tendency of being in contact with multiple partners, measures of centralisation
  # distribution of node-based edge counts, each node counts only once
  # number means weight parameter decay
  # The closer decay is to zero, the more gwdegree considers low degree nodes relative to high degree nodes
summary(model.2)

# model 3 with node attributes
model.3 <- burial_network_pre ~ edges +  # the overall density of the network
  nodematch('quantity') + # quantity-based homophily, categorical nodal attribute, the similarity of connected nodes
  nodematch('age') +
  gwesp(0.2, fixed = TRUE) +    # transitivity
  gwdegree(0.8, fixed = TRUE)   # popularity
summary(model.3)
```


<!--interpretation of Bayesian modeling--> 

Normal distribution ùúÉ ‚àº Nd (ùúáprior , Œ£prior ) is viewed as a suitable prior model for the model parameters of interests in network analysis if there is no previous observation for a network[@Caimo2017]. Since our original data presents a pattern of dense ties, we specified the prior based on our observation that assumes a high density and high transitivity network. 

```{r Bayesian-ERGMs}
# Specify a prior distribution: normal distribution (low density and high transitivity)
# need to observe the graph and select suitable prior 
prior.mean <- c(1, 0, 0, 3, 0) # prior mean corresponds to mean for each parameter
# follow Alberto Caimo et al. (2015) hospital example
prior.sigma <- diag(3, 5, 5) # covariance matrix structure
# where the dimension d corresponds to the number of parameters, ùúá is mean vector and Œ£prior is a d √ó d covariance matrix.

# Estimated posterior means, medians and 95% credible intervals for Models.3
# bergmM: Bayesian exponential random graphs models under missing data using the approximate exchange algorithm. Use this because of missing data for age variable
parpost <- bergmM(model.3,
                  prior.mean  = prior.mean,
                  prior.sigma = prior.sigma,
                  burn.in     = 200, # burn-in iterations for every chain of the population, drops the first 200
                  main.iters  = 2000, # iterations for every chain of the population
                  aux.iters   = 10000, # MCMC steps used for network simulation
                  nchains     = 8, # number of chains of the population MCMC
                  gamma       = 0.7) # scalar; parallel adaptive direction sampling move factor, acceptance rate

# summary of parameter estimation
summary(parpost)

# plot the parameter posterior distribution
plot(parpost)
```

## Structure Effects

The summary presents the statistics that each Œ∏ corresponds to the parameter specified in ERGM previously. In general, positive mean indicates positive correlation, while negative mean indicates negative correlation. 

Œ∏1 = number of ties
Œ∏2 = individuals with the same abundance of burial goods
Œ∏3 = gwesp, a positive sign suggests a tendency of burials in our sample to group together in closed transitive structures. In mortuary context, clustering implies a tendency of burials with the same status indicated by prestige goods to be organised in closed structures. Burials with multiple prestige goods in common are more likely to be directed connected.
Œ∏4 = gwdegree, negative estimates reflect an increased likelihood on ties to higher-degree nodes, or the strong edges are not necessarily centralised or dispersed in the degree distribution.

The plots from left to right show estimated marginal posterior densities, trace plots, and autocorrelation plots.


```{r Bayesian-gof}
# Model assessment, Bayesian goodness of fit diagnostics:
bgof(parpost,
     aux.iters = 10000,
     n.deg     = 14,
     n.dist    = 15,
     n.esp     = 9)

# An estimated ERGM is fitting perfectly a certain observed network if the red line falls inside this interval
# a result that is very difficult to obtain in practice (Caimo 2017)
```

Figure shows the Bayesian goodness of fit diagnostics plots where the red lines represent the distributions of the observed data and the box plots represent the GOF distributions of 10000 network graphs simulated from ERGMs based on the estimated posterior distribution. The grey lines mark the 95% intervals. 


```{r Bayesian-gof}
# Model assessment, Bayesian goodness of fit diagnostics:
bgof(parpost,
     aux.iters = 10000,
     n.deg     = 14,
     n.dist    = 15,
     n.esp     = 9)

# An estimated ERGM is fitting perfectly a certain observed network if the red line falls inside this interval
# a result that is very difficult to obtain in practice (Caimo 2017)
```

Figure shows the Bayesian goodness of fit diagnostics plots where the red lines represent the distributions of the observed data and the box plots represent the GOF distributions of 10000 network graphs simulated from ERGMs based on the estimated posterior distribution. The grey lines mark the 95% intervals. X-axis means the proportion of nodes

# Discussion

# Conclusion

# Acknowledgments

<!-- The following line inserts a page break when the output is MS Word. For page breaks in PDF, use \newpage on its own line.  -->
##### pagebreak

# References 
<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->
<div id="refs"></div>

##### pagebreak

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
